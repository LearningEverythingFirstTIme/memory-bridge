# Kimi Claw Memory System â€” Technical Architecture Diagram

> **Comprehensive Audit & Technical Documentation**  
> Generated: 2026-02-25  
> System Version: v3.1.0 (proactive-agent skill)

---

## Table of Contents

1. [Executive Summary](#executive-summary)
2. [Architecture Overview](#architecture-overview)
3. [Memory Layer Hierarchy](#memory-layer-hierarchy)
4. [Data Flow Diagrams](#data-flow-diagrams)
5. [WAL Protocol Execution Flow](#wal-protocol-execution-flow)
6. [Session Lifecycle](#session-lifecycle)
7. [Automation Schedule](#automation-schedule)
8. [File Format Specifications](#file-format-specifications)
9. [Script Reference](#script-reference)
10. [Edge Cases & Failure Modes](#edge-cases--failure-modes)
11. [Recovery Procedures](#recovery-procedures)

---

## Executive Summary

The Kimi Claw memory system is a **four-tier persistence architecture** designed to solve the fundamental problem of AI agents waking up fresh each session. It implements:

- **Write-Ahead Logging (WAL) Protocol** â€” Immediate capture of critical details
- **Working Buffer** â€” Session-local ephemeral context
- **Automated Distillation** â€” 9 PM daily journal generation
- **Heartbeat Sync** â€” Periodic SESSION-STATE updates

**Key Design Principles:**
1. Text > Brain â€” If it's important, write it immediately
2. Survival after compaction â€” Working Buffer captures danger zone
3. Automated maintenance â€” Scripts handle archival and sync
4. Human-readable formats â€” Markdown for all storage layers

---

## Architecture Overview

### System Component Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           KIMI CLAW MEMORY SYSTEM                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         SESSION LIFECYCLE                           â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚   START â†’ DURING â†’ [DANGER ZONE >60%] â†’ END â†’ FLUSH â†’ DISTILL     â”‚   â”‚
â”‚  â”‚     â”‚        â”‚           â”‚              â”‚      â”‚         â”‚         â”‚   â”‚
â”‚  â”‚     â–¼        â–¼           â–¼              â–¼      â–¼         â–¼         â”‚   â”‚
â”‚  â”‚  Read    WAL Write   Buffer Log    Capture  Archive   Journal      â”‚   â”‚
â”‚  â”‚  Files   (immediate) (every msg)   File     Capture   Generate     â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        MEMORY LAYERS                                â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚   LAYER 1: EPHEMERAL (Session-only)                                 â”‚   â”‚
â”‚  â”‚   â”œâ”€â”€ working-buffer.md â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Flushed to capture          â”‚   â”‚
â”‚  â”‚   â””â”€â”€ Chat history buffer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Lost at session end         â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚   LAYER 2: DAILY (Raw captures)                                     â”‚   â”‚
â”‚  â”‚   â”œâ”€â”€ memory/capture/YYYY-MM-DD.md â”€â”€â–º Archived after journal      â”‚   â”‚
â”‚  â”‚   â””â”€â”€ memory/YYYY-MM-DD.md â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Permanent raw logs          â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚   LAYER 3: DISTILLED (Processed summaries)                          â”‚   â”‚
â”‚  â”‚   â””â”€â”€ memory/journal/YYYY-MM-DD.md â”€â”€â–º Permanent archive           â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚   LAYER 4: PERSISTENT (Long-term state)                             â”‚   â”‚
â”‚  â”‚   â”œâ”€â”€ SESSION-STATE.md â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Auto-sync every 10HB        â”‚   â”‚
â”‚  â”‚   â”œâ”€â”€ MEMORY.md â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Manual curation             â”‚   â”‚
â”‚  â”‚   â”œâ”€â”€ USER.md â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Profile (rarely changes)    â”‚   â”‚
â”‚  â”‚   â”œâ”€â”€ SOUL.md â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Identity (static)           â”‚   â”‚
â”‚  â”‚   â””â”€â”€ AGENTS.md â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Operating rules             â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      AUTOMATION TRIGGERS                            â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚   9:00 PM EST â”€â”€â”€â”€â”€â–º evening-journal.py â”€â”€â”€â”€â”€â–º Journal + Archive   â”‚   â”‚
â”‚  â”‚   Every HB â”€â”€â”€â”€â”€â”€â”€â”€â–º heartbeat-tracker.py â”€â”€â”€â–º Sync every 10HB     â”‚   â”‚
â”‚  â”‚   >24h stale â”€â”€â”€â”€â”€â”€â–º flush-working-buffer.py â”€â–º Auto-flush         â”‚   â”‚
â”‚  â”‚   Mondays 10AM â”€â”€â”€â”€â–º memory-health-check.py â”€â–º Health report       â”‚   â”‚
â”‚  â”‚   Every 2hrs â”€â”€â”€â”€â”€â”€â–º fidget-checker.py â”€â”€â”€â”€â”€â”€â–º Product alerts      â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Memory Layer Hierarchy

### Layer 1: Ephemeral (Session-Local)

| Component | File | Persistence | Purpose |
|-----------|------|-------------|---------|
| Working Buffer | `working-buffer.md` | Session only | Current task, timeline, recent WAL entries |
| Chat History | In-memory | Lost at session end | Conversation context (unreliable) |

**Characteristics:**
- Created at session start from template
- Updated continuously during session
- Flushed to capture file at session end
- Reset to template after flush
- **DO NOT READ for new sessions** â€” already flushed

### Layer 2: Daily (Raw Captures)

| Component | File | Persistence | Purpose |
|-----------|------|-------------|---------|
| Capture File | `memory/capture/YYYY-MM-DD.md` | Until 9 PM, then archived | WAL entries from session |
| Daily Notes | `memory/YYYY-MM-DD.md` | Permanent | Raw logs of what happened |

**Characteristics:**
- Capture files use strict WAL format: `- [HH:MM] [tag] Content`
- Archived to `.archived.md` after journal generation
- Multiple archives possible: `YYYY-MM-DD.timestamp.archived.md`
- Daily notes are freeform (not parsed)

### Layer 3: Distilled (Processed)

| Component | File | Persistence | Purpose |
|-----------|------|-------------|---------|
| Evening Journal | `memory/journal/YYYY-MM-DD.md` | Permanent | Structured summary for next session |

**Characteristics:**
- Auto-generated at 9 PM EST by `evening-journal.py`
- Parsed from capture files using regex pattern
- Categorized by tag: Decisions, Friction, Wins, Ideas, Mood, Questions, Open Loops, Notes
- **Read FIRST at session start** for continuity

### Layer 4: Persistent (Long-Term)

| Component | File | Update Trigger | Persistence |
|-----------|------|----------------|-------------|
| Session State | `SESSION-STATE.md` | Every 10 heartbeats (~5h) | Permanent |
| Long-Term Memory | `MEMORY.md` | Manual curation | Permanent |
| User Profile | `USER.md` | Profile changes | Permanent |
| Agent Identity | `SOUL.md` | Identity evolution | Permanent |
| Operating Rules | `AGENTS.md` | Lessons learned | Permanent |
| Tool Config | `TOOLS.md` | Tool changes | Permanent |

---

## Data Flow Diagrams

### Flow 1: Session Start (Reading)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Session Start  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MANDATORY READ ORDER                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. MEMORY-QUICKREF.md â”€â”€â–º System orientation                   â”‚
â”‚  2. SOUL.md â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Identity, principles                 â”‚
â”‚  3. USER.md â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Nick's profile                       â”‚
â”‚  4. memory/journal/YYYY-MM-DD.md â”€â”€â–º Yesterday's summary        â”‚
â”‚  5. memory/YYYY-MM-DD.md â”€â”€â–º Today's raw notes (if exist)       â”‚
â”‚  6. memory/capture/*.md â”€â”€â–º Newest capture (if exist)           â”‚
â”‚  7. SESSION-STATE.md â”€â”€â–º Active projects, persistent context    â”‚
â”‚  8. MEMORY.md â”€â”€â–º Long-term curated memory (main sessions)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Ready to Work  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Flow 2: During Session (WAL Protocol)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     EVERY MESSAGE RECEIVED                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCAN FOR TRIGGERS:                                             â”‚
â”‚  âœï¸ Corrections â”€â”€â–º "It's X, not Y" / "Actually..."             â”‚
â”‚  ğŸ“ Proper nouns â”€â”€â–º Names, places, companies                   â”‚
â”‚  ğŸ¨ Preferences â”€â”€â–º "I like/don't like"                         â”‚
â”‚  ğŸ“‹ Decisions â”€â”€â–º "Let's do X" / "Go with Y"                    â”‚
â”‚  ğŸ“ Draft changes â”€â”€â–º Edits to current work                     â”‚
â”‚  ğŸ”¢ Specific values â”€â”€â–º Numbers, dates, IDs, URLs               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚         â”‚
  MATCH    NO MATCH
    â”‚         â”‚
    â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STOP  â”‚ â”‚ Respond Normallyâ”‚
â”‚ WRITE  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ THEN   â”‚
â”‚RESPOND â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WRITE TO SESSION-STATE.md:                                     â”‚
â”‚  - Corrections â”€â”€â–º Update existing entries                      â”‚
â”‚  - Proper nouns â”€â”€â–º Add to profile/context                      â”‚
â”‚  - Preferences â”€â”€â–º Add to preferences section                   â”‚
â”‚  - Decisions â”€â”€â–º Add to Key Decisions table                     â”‚
â”‚  - Draft changes â”€â”€â–º Update current task                        â”‚
â”‚  - Specific values â”€â”€â–º Add to relevant section                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UPDATE working-buffer.md:                                      â”‚
â”‚  - Add to Recent WAL Entries                                    â”‚
â”‚  - Update Session Timeline                                      â”‚
â”‚  - Update Current Task (if changed)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Now Respond    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Flow 3: Session End (Capture)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SESSION END SIGNAL DETECTED:                                   â”‚
â”‚  "Remember anything useful..."                                  â”‚
â”‚  "Starting a new session soon"                                  â”‚
â”‚  "Wrap this up"                                                 â”‚
â”‚  "Perform your memory ritual"                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: FLUSH WORKING BUFFER                                   â”‚
â”‚  Run: scripts/flush-working-buffer.py                           â”‚
â”‚  - Extracts WAL entries from working-buffer.md                  â”‚
â”‚  - Appends to memory/capture/YYYY-MM-DD.md                      â”‚
â”‚  - Resets working-buffer.md to template                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: RETROSPECTIVE REVIEW                                   â”‚
â”‚  - Review full conversation history                             â”‚
â”‚  - Extract decisions, friction, wins, ideas                     â”‚
â”‚  - Capture mood, questions, open loops                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: WRITE TO CAPTURE FILE                                  â”‚
â”‚  File: memory/capture/YYYY-MM-DD.md                             â”‚
â”‚  Format:                                                        â”‚
â”‚  # Session Capture â€” YYYY-MM-DD                                 â”‚
â”‚  ## Summary                                                     â”‚
â”‚  [1-2 sentence summary]                                         â”‚
â”‚  ## WAL Entries                                                 â”‚
â”‚  - [HH:MM] [tag] Content                                        â”‚
â”‚  - [HH:MM] [tag] Content                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: REPORT BACK                                            â”‚
â”‚  "Captured X decisions, Y wins, Z open loops"                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Flow 4: Evening Journal Generation (9 PM EST)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  9:00 PM EST    â”‚
â”‚  Cron Trigger   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  evening-journal.py                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: PARSE CAPTURE FILE                                     â”‚
â”‚  Input: memory/capture/YYYY-MM-DD.md                            â”‚
â”‚  Pattern: ^- \[(\d{2}:\d{2})\] \[(\w+)\] (.+)$                 â”‚
â”‚  Valid tags: decision, friction, win, idea, mood, question,     â”‚
â”‚              open-loop, note                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: CATEGORIZE ENTRIES                                     â”‚
â”‚  Group by tag â†’ Sections                                        â”‚
â”‚  - decision â†’ ## Decisions                                      â”‚
â”‚  - friction â†’ ## Friction Points                                â”‚
â”‚  - win â†’ ## Wins                                                â”‚
â”‚  - idea â†’ ## Ideas Captured                                     â”‚
â”‚  - mood â†’ ## Mood & Context                                     â”‚
â”‚  - question â†’ ## Questions                                      â”‚
â”‚  - open-loop â†’ ## Open Loops (with checkboxes)                  â”‚
â”‚  - note â†’ ## Notes                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: GENERATE JOURNAL                                       â”‚
â”‚  Output: memory/journal/YYYY-MM-DD.md                           â”‚
â”‚  Format: Structured markdown with sections                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: ARCHIVE CAPTURE                                        â”‚
â”‚  Rename: memory/capture/YYYY-MM-DD.md                           â”‚
â”‚      â”€â”€â–º memory/capture/YYYY-MM-DD.archived.md                  â”‚
â”‚  If exists: YYYY-MM-DD.timestamp.archived.md                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Flow 5: Heartbeat Sync (Every 10 Heartbeats)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Heartbeat      â”‚
â”‚  Received       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  heartbeat-tracker.py                                           â”‚
â”‚  - Increments heartbeat-state.json counter                      â”‚
â”‚  - Checks if sync needed (every 10 HBs)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚         â”‚
  SYNC=10   SYNC<10
    â”‚         â”‚
    â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Trigger â”‚ â”‚ Increment only  â”‚
â”‚  Sync  â”‚ â”‚ (no action)     â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  sync-session-state.py                                          â”‚
â”‚  - Scans capture files (last 2 days)                            â”‚
â”‚  - Scans journal files (last 2 days)                            â”‚
â”‚  - Extracts [decision] entries                                  â”‚
â”‚  - Extracts [open-loop] entries                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UPDATE SESSION-STATE.md                                        â”‚
â”‚  Append to: ## Auto-Sync Update â€” YYYY-MM-DD HH:MM UTC          â”‚
â”‚  - Recent Decisions (last 5)                                    â”‚
â”‚  - Active Open Loops (last 5)                                   â”‚
â”‚  Update: *Last updated: YYYY-MM-DD by auto-sync*                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UPDATE heartbeat-state.json                                    â”‚
â”‚  - lastSyncHeartbeat = current count                            â”‚
â”‚  - lastSyncTime = now                                           â”‚
â”‚  - totalSyncs += 1                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## WAL Protocol Execution Flow

### Detailed State Machine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         WAL PROTOCOL STATE MACHINE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                            â”‚
â”‚  â”‚    IDLE     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  (waiting)  â”‚                                                      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                      â”‚     â”‚
â”‚         â”‚ Message received                                            â”‚     â”‚
â”‚         â–¼                                                             â”‚     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     No triggers      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚     â”‚
â”‚  â”‚    SCAN     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   RESPOND   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”‚  (triggers) â”‚                      â”‚  (normal)   â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚         â”‚ Trigger found                                                     â”‚
â”‚         â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                            â”‚
â”‚  â”‚    STOP     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  (halt      â”‚                                                      â”‚     â”‚
â”‚  â”‚  response)  â”‚                                                      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                      â”‚     â”‚
â”‚         â”‚                                                             â”‚     â”‚
â”‚         â–¼                                                             â”‚     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚  â”‚  WRITE TO SESSION-STATE.md                                      â”‚  â”‚     â”‚
â”‚  â”‚                                                                 â”‚  â”‚     â”‚
â”‚  â”‚  Corrections â”€â”€â–º Update existing entries                        â”‚  â”‚     â”‚
â”‚  â”‚  Example: "Theme: blue (not red)"                               â”‚  â”‚     â”‚
â”‚  â”‚                                                                 â”‚  â”‚     â”‚
â”‚  â”‚  Proper nouns â”€â”€â–º Add to Critical Context section               â”‚  â”‚     â”‚
â”‚  â”‚  Example: "Jim - AA Sponsor, uses finance app"                  â”‚  â”‚     â”‚
â”‚  â”‚                                                                 â”‚  â”‚     â”‚
â”‚  â”‚  Preferences â”€â”€â–º Add to How To Work With Nick                   â”‚  â”‚     â”‚
â”‚  â”‚  Example: "Discord DMs preferred"                               â”‚  â”‚     â”‚
â”‚  â”‚                                                                 â”‚  â”‚     â”‚
â”‚  â”‚  Decisions â”€â”€â–º Add to Key Decisions table                       â”‚  â”‚     â”‚
â”‚  â”‚  Example: "| 2026-02-25 | Memory system audit | Nick request |" â”‚  â”‚     â”‚
â”‚  â”‚                                                                 â”‚  â”‚     â”‚
â”‚  â”‚  Specific values â”€â”€â–º Add to relevant section                    â”‚  â”‚     â”‚
â”‚  â”‚  Example: "Channel ID: 1474399095279063150"                     â”‚  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚         â”‚                                                             â”‚     â”‚
â”‚         â–¼                                                             â”‚     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚  â”‚  UPDATE working-buffer.md                                       â”‚  â”‚     â”‚
â”‚  â”‚                                                                 â”‚  â”‚     â”‚
â”‚  â”‚  ## Recent WAL Entries                                          â”‚  â”‚     â”‚
â”‚  â”‚  - [HH:MM] [tag] Brief content summary                          â”‚  â”‚     â”‚
â”‚  â”‚                                                                 â”‚  â”‚     â”‚
â”‚  â”‚  ## Session Timeline                                            â”‚  â”‚     â”‚
â”‚  â”‚  - [HH:MM] What happened                                        â”‚  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚         â”‚                                                             â”‚     â”‚
â”‚         â–¼                                                             â”‚     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                      â”‚     â”‚
â”‚  â”‚   RESPOND   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”‚  (now with  â”‚                                                            â”‚
â”‚  â”‚  context    â”‚                                                            â”‚
â”‚  â”‚  preserved) â”‚                                                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Trigger Detection Regex Patterns

```python
# Corrections
r"(?i)(it's\s+\w+,?\s+not\s+\w+|actually,?\s+|no,?\s+i\s+meant|i\s+said\s+|correction:|wait,\s+)"

# Proper nouns (simplified - actual detection is contextual)
# Capitalized words in specific contexts
# Names following "my wife", "my sponsor", "called", etc.

# Preferences
r"(?i)(i\s+(like|prefer|want|don't\s+like|hate)|use\s+\w+\s+instead|go\s+with|choose\s+)"

# Decisions
r"(?i)(let's\s+\w+|we\s+should\s+|go\s+with\s+|use\s+\w+\s+for|decided\s+to\s+|settle\s+on\s+)"

# Specific values (patterns)
# URLs: r"https?://\S+"
# Dates: r"\d{4}-\d{2}-\d{2}"
# Times: r"\d{1,2}:\d{2}"
# Numbers with units: r"\d+\s*(px|em|rem|gb|mb|min|hours?)"
```

---

## Session Lifecycle

### Complete Lifecycle Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        COMPLETE SESSION LIFECYCLE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  PHASE 1: INITIALIZATION                                                    â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  System     â”‚â”€â”€â”€â–ºâ”‚  Read       â”‚â”€â”€â”€â–ºâ”‚  Read       â”‚â”€â”€â”€â–ºâ”‚  Read       â”‚  â”‚
â”‚  â”‚  Boot       â”‚    â”‚  MEMORY-    â”‚    â”‚  SOUL.md    â”‚    â”‚  USER.md    â”‚  â”‚
â”‚  â”‚             â”‚    â”‚  QUICKREF   â”‚    â”‚  (identity) â”‚    â”‚  (profile)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                    â”‚        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚        â”‚
â”‚  â”‚  Read       â”‚â—„â”€â”€â”€â”‚  Read       â”‚â—„â”€â”€â”€â”‚  Read       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  â”‚  Capture    â”‚    â”‚  Daily      â”‚    â”‚  Journal    â”‚                     â”‚
â”‚  â”‚  (newest)   â”‚    â”‚  Notes      â”‚    â”‚  (yesterday)â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚         â”‚                                                           â”‚       â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                              â”‚                                              â”‚
â”‚                              â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  CREATE working-buffer.md from template                             â”‚   â”‚
â”‚  â”‚  - Current Task: [blank]                                            â”‚   â”‚
â”‚  â”‚  - Session Timeline: [blank]                                        â”‚   â”‚
â”‚  â”‚  - Recent WAL Entries: [blank]                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                              â”‚
â”‚                              â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  READ SESSION-STATE.md (persistent context)                         â”‚   â”‚
â”‚  â”‚  - Active projects                                                  â”‚   â”‚
â”‚  â”‚  - Key decisions                                                    â”‚   â”‚
â”‚  â”‚  - Connected services                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                              â”‚
â”‚                              â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚  READY STATE    â”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                              â”‚                                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                              â–¼                                              â”‚
â”‚  PHASE 2: ACTIVE SESSION                                                    â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                   â”‚
â”‚                              â”‚                                              â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚         â”‚                    â”‚                    â”‚                         â”‚
â”‚         â–¼                    â–¼                    â–¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  Normal     â”‚      â”‚  WAL        â”‚      â”‚  Context    â”‚                 â”‚
â”‚  â”‚  Message    â”‚      â”‚  Trigger    â”‚      â”‚  >60%       â”‚                 â”‚
â”‚  â”‚  (no action)â”‚      â”‚  (write     â”‚      â”‚  (buffer    â”‚                 â”‚
â”‚  â”‚             â”‚      â”‚  first)     â”‚      â”‚  log)       â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                              â”‚                    â”‚                         â”‚
â”‚                              â–¼                    â–¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  UPDATE working-buffer.md                                           â”‚   â”‚
â”‚  â”‚  - Add to Session Timeline                                          â”‚   â”‚
â”‚  â”‚  - Add to Recent WAL Entries                                        â”‚   â”‚
â”‚  â”‚  - Update Current Task (if changed)                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                              â–¼                                              â”‚
â”‚  PHASE 3: COMPACTION (if triggered)                                         â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                   â”‚
â”‚                              â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  DETECT: <summary> tag, "context truncated", "where were we?"       â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  RECOVERY PROTOCOL:                                                 â”‚   â”‚
â”‚  â”‚  1. Read working-buffer.md â”€â”€â–º Raw danger-zone exchanges            â”‚   â”‚
â”‚  â”‚  2. Read SESSION-STATE.md â”€â”€â–º Active task state                     â”‚   â”‚
â”‚  â”‚  3. Read capture/journal â”€â”€â–º Recent history                         â”‚   â”‚
â”‚  â”‚  4. Present: "Recovered. Last task was X. Continue?"                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                              â–¼                                              â”‚
â”‚  PHASE 4: SESSION END                                                       â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                   â”‚
â”‚                              â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  TRIGGER PHRASES DETECTED:                                          â”‚   â”‚
â”‚  â”‚  - "Remember anything useful..."                                    â”‚   â”‚
â”‚  â”‚  - "Starting a new session soon"                                    â”‚   â”‚
â”‚  â”‚  - "Wrap this up"                                                   â”‚   â”‚
â”‚  â”‚  - "Perform your memory ritual"                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                              â”‚
â”‚                              â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  STEP 1: FLUSH WORKING BUFFER                                       â”‚   â”‚
â”‚  â”‚  Run: python3 scripts/flush-working-buffer.py                       â”‚   â”‚
â”‚  â”‚  - Extracts WAL entries                                             â”‚   â”‚
â”‚  â”‚  - Appends to memory/capture/YYYY-MM-DD.md                          â”‚   â”‚
â”‚  â”‚  - Resets buffer to template                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                              â”‚
â”‚                              â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  STEP 2: RETROSPECTIVE                                              â”‚   â”‚
â”‚  â”‚  - Review conversation history                                      â”‚   â”‚
â”‚  â”‚  - Extract decisions, friction, wins, ideas                         â”‚   â”‚
â”‚  â”‚  - Capture mood, questions, open loops                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                              â”‚
â”‚                              â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  STEP 3: WRITE CAPTURE FILE                                         â”‚   â”‚
â”‚  â”‚  File: memory/capture/YYYY-MM-DD.md                                 â”‚   â”‚
â”‚  â”‚  Format:                                                            â”‚   â”‚
â”‚  â”‚  # Session Capture â€” YYYY-MM-DD                                     â”‚   â”‚
â”‚  â”‚  ## Summary                                                         â”‚   â”‚
â”‚  â”‚  ## WAL Entries                                                     â”‚   â”‚
â”‚  â”‚  - [HH:MM] [tag] Content                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                              â”‚
â”‚                              â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  STEP 4: REPORT BACK                                                â”‚   â”‚
â”‚  â”‚  "Captured X decisions, Y wins, Z open loops"                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                              â”‚
â”‚                              â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚  â”‚  SESSION ENDED  â”‚                                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                              â”‚                                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                              â–¼                                              â”‚
â”‚  PHASE 5: AUTOMATED PROCESSING (9 PM EST)                                   â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                    â”‚
â”‚                              â”‚                                              â”‚
â”‚                              â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  evening-journal.py (cron job)                                      â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  Input: memory/capture/YYYY-MM-DD.md                                â”‚   â”‚
â”‚  â”‚  Output: memory/journal/YYYY-MM-DD.md                               â”‚   â”‚
â”‚  â”‚  Side effect: Archive capture file                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                              â”‚
â”‚                              â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  NEXT SESSION: Read journal first for continuity                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Automation Schedule

### Cron Job Configuration Table

| Job Name | Script | Schedule | Timezone | Target | Purpose |
|----------|--------|----------|----------|--------|---------|
| Evening Journal | `evening-journal.py` | Daily 9:00 PM | America/New_York | Isolated agent | Distill captures â†’ journal |
| Excel Tips | (skill-based) | Daily 7:00 AM | America/New_York | Isolated agent | Send Excel tip to Discord |
| Excel Afternoon | (skill-based) | Daily 1:30 PM | America/New_York | Isolated agent | Excel reminder |
| Health Check | `memory-health-check.py` | Mondays 10:00 AM | America/New_York | Isolated agent | System health report |
| Fidget Check | `fidget-checker.py` | Every 2 hours | UTC | Isolated agent | Product change detection |
| Heartbeat Sync | `heartbeat-tracker.py` | Every heartbeat | UTC | Main session | Trigger sync every 10HB |

### Automation Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AUTOMATION ARCHITECTURE                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  CRON SCHEDULER (openclaw cron)                                     â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ 9:00 PM     â”‚  â”‚ 7:00 AM     â”‚  â”‚ 1:30 PM     â”‚  â”‚ Mondays    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Daily       â”‚  â”‚ Daily       â”‚  â”‚ Daily       â”‚  â”‚ 10:00 AM   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Journal     â”‚  â”‚ Excel Tips  â”‚  â”‚ Excel PM    â”‚  â”‚ Health     â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚         â”‚                â”‚                â”‚               â”‚        â”‚   â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚   â”‚
â”‚  â”‚                              â”‚                                      â”‚   â”‚
â”‚  â”‚                              â–¼                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  sessionTarget: "isolated"                                  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  payload.kind: "agentTurn"                                  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  delivery.channel: "discord"                                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  delivery.to: "channel:1474399095279063150"                 â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                              â”‚                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚                                           â”‚
â”‚                                 â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ISOLATED AGENT SESSION                                             â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Run Script  â”‚  â”‚ Generate    â”‚  â”‚ Send to     â”‚  â”‚ Exit       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ (Python)    â”‚â”€â–ºâ”‚ Output      â”‚â”€â–ºâ”‚ Discord     â”‚â”€â–ºâ”‚            â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  HEARTBEAT SYSTEM (Main Session)                                    â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚  Heartbeat Received â”€â”€â–º heartbeat-tracker.py                        â”‚   â”‚
â”‚  â”‚       â”‚                                                             â”‚   â”‚
â”‚  â”‚       â–¼                                                             â”‚   â”‚
â”‚  â”‚  Increment counter â”€â”€â–º Check if % 10 == 0                           â”‚   â”‚
â”‚  â”‚       â”‚                                                             â”‚   â”‚
â”‚  â”‚       â–¼ (yes)                                                       â”‚   â”‚
â”‚  â”‚  Run sync-session-state.py â”€â”€â–º Update SESSION-STATE.md              â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## File Format Specifications

### 1. Working Buffer Format

**File:** `working-buffer.md`

```markdown
# Working Buffer â€” YYYY-MM-DD

> Session-local context. Ephemeral â€” flushed to capture file when session ends.
> **For persistent context** (projects, profile), see `SESSION-STATE.md`.

---

## Current Task
[What we're working on right now]

## Session Timeline
- [HH:MM] Event description
- [HH:MM] Another event

## Blockers
[Any immediate obstacles]

## Decisions Pending
[Awaiting Nick's input]

## What Would Help Right Now
[Immediate needs]

## Open Loops
[Unfinished business]

## Recent WAL Entries
- [HH:MM] [tag] Content
- [HH:MM] [tag] Content

---

*This file is ephemeral. Contents are flushed to `memory/capture/YYYY-MM-DD.md` at session end.*
*For durable context, see `SESSION-STATE.md` and `MEMORY.md`*
```

### 2. Capture File Format

**File:** `memory/capture/YYYY-MM-DD.md`

```markdown
# Session Capture â€” YYYY-MM-DD

## Summary
[1-2 sentence summary of the session]

## WAL Entries
- [HH:MM] [decision] Decision content
- [HH:MM] [friction] Problem encountered
- [HH:MM] [win] Success description
- [HH:MM] [idea] Concept to explore
- [HH:MM] [mood] Emotional state
- [HH:MM] [question] Unanswered question
- [HH:MM] [open-loop] Unfinished business
- [HH:MM] [note] General context
```

**CRITICAL:** The parser uses regex pattern `^- \[(\d{2}:\d{2})\] \[(\w+)\] (.+)$`
- Lines MUST start with `- [HH:MM] [tag] `
- Valid tags: `decision`, `friction`, `win`, `idea`, `mood`, `question`, `open-loop`, `note`
- Invalid tags are converted to `note` with warning

### 3. Journal File Format

**File:** `memory/journal/YYYY-MM-DD.md`

```markdown
# Evening Journal â€” YYYY-MM-DD

## Decisions
- Decision content (from [decision] tags)

## Friction Points
- Friction content (from [friction] tags)

## Wins
- Win content (from [win] tags)

## Ideas Captured
- Idea content (from [idea] tags)

## Mood & Context
- Mood content (from [mood] tags)

## Questions
- Question content (from [question] tags)

## Open Loops
- [ ] Open loop content (from [open-loop] tags)

## Notes
- Note content (from [note] tags or invalid tags)

---
*Generated: YYYY-MM-DD HH:MM UTC*
```

### 4. SESSION-STATE Format

**File:** `SESSION-STATE.md`

```markdown
# SESSION-STATE.md â€” Persistent Context

> Durable memory that survives sessions.

---

## Critical Context About Nick
- Key facts about the user

## Family & Support Network
| Person | Relationship | Notes |

## Work Context
- Work details

## Skills & Learning
- Current learning focus

## How To Work With Nick
- Preferences and patterns

---

## Completed Projects
### Project Name (STATUS)
- Details

---

## Active Automations
| Job | Schedule | Status |

---

## Connected Services
- Service list

## Cloned Repositories
| Repo | Local Path | Notes |

---

## Key Decisions (Curated)
| Date | Decision | Source |

---

## Notes for Future Sessions
- Quick reminders

## Auto-Sync Update â€” YYYY-MM-DD HH:MM UTC
---
### Recent Decisions
- [date time] Decision content

### Active Open Loops
- [ ] date: Open loop content

---
*Last updated: YYYY-MM-DD by auto-sync*
*Auto-sync: Every ~5 hours | Manual updates: As needed*
```

### 5. Heartbeat State Format

**File:** `memory/heartbeat-state.json`

```json
{
  "heartbeatCount": 11,
  "lastSyncHeartbeat": 10,
  "syncInterval": 10,
  "lastSyncTime": "2026-02-25T05:15:09.084473+00:00",
  "totalSyncs": 1
}
```

### 6. Fidget Snapshot Format

**File:** `memory/fidget-snapshot.json`

```json
{
  "timestamp": "2026-02-25T14:15:00",
  "url": "https://www.plantswakeyouup.com/collections/fidget-toys",
  "products": [
    {
      "title": "Product Name",
      "price": "$XX.XX",
      "url": "https://...",
      "image": "https://..."
    }
  ],
  "count": 32
}
```

---

## Script Reference

### Script Inventory

| Script | Purpose | Trigger | Input | Output |
|--------|---------|---------|-------|--------|
| `evening-journal.py` | Distill captures â†’ journal | Cron (9 PM EST) | `memory/capture/YYYY-MM-DD.md` | `memory/journal/YYYY-MM-DD.md` + archive |
| `flush-working-buffer.py` | Flush stale buffer | Manual (session end) or >24h | `working-buffer.md` | `memory/capture/YYYY-MM-DD.md` + reset buffer |
| `heartbeat-tracker.py` | Track HB count, trigger sync | Every heartbeat | `memory/heartbeat-state.json` | Updated state + sync trigger |
| `sync-session-state.py` | Sync SESSION-STATE with recent activity | Every 10 HBs | Capture/journal files (2 days) | Updated `SESSION-STATE.md` |
| `memory-health-check.py` | System health check | Cron (Mon 10 AM) or manual | All memory files | Health report + JSON log |
| `fidget-checker.py` | Product change detection | Cron (every 2h) | Website + snapshot | Notification (if changes) |

### Script Dependencies

```
evening-journal.py
â”œâ”€â”€ Standard library: datetime, pathlib, re
â””â”€â”€ No external dependencies

flush-working-buffer.py
â”œâ”€â”€ Standard library: datetime, pathlib, re
â””â”€â”€ No external dependencies

heartbeat-tracker.py
â”œâ”€â”€ Standard library: json, subprocess, datetime, pathlib
â””â”€â”€ Calls: sync-session-state.py

sync-session-state.py
â”œâ”€â”€ Standard library: re, datetime, pathlib, argparse
â””â”€â”€ No external dependencies

memory-health-check.py
â”œâ”€â”€ Standard library: json, datetime, pathlib
â””â”€â”€ No external dependencies

fidget-checker.py
â”œâ”€â”€ Standard library: json, hashlib, datetime, pathlib
â””â”€â”€ External: requests, beautifulsoup4
```

---

## Edge Cases & Failure Modes

### E1: Capture File Not Found at Journal Time

**Scenario:** `evening-journal.py` runs but no capture file exists for today.

**Behavior:**
- Creates empty journal: "*No captures recorded today.*"
- Does not error
- Continues normally

**Recovery:** None needed â€” indicates no activity that day.

### E2: Invalid Tags in Capture File

**Scenario:** User writes `- [14:30] [invalidtag] Content`

**Behavior:**
- Parser detects invalid tag (not in VALID_TAGS set)
- Converts to `[note]` tag
- Prints warning: "Found N entries with invalid tags"
- Continues processing

**Recovery:** None needed â€” data preserved as note.

### E3: Multiple Capture Files Same Day

**Scenario:** Multiple sessions â†’ multiple captures â†’ archive collision.

**Behavior:**
- First archive: `YYYY-MM-DD.archived.md`
- Subsequent archives: `YYYY-MM-DD.timestamp.archived.md`
- All captures preserved

**Recovery:** None needed â€” timestamp disambiguates.

### E4: Working Buffer Not Flushed

**Scenario:** Session ends without explicit flush signal.

**Behavior:**
- Buffer remains with stale content
- `flush-working-buffer.py` detects >24h age
- Auto-flushes on next run
- May lose context if new session starts

**Recovery:** Manual flush or auto-flush after 24h.

### E5: Context Compaction Mid-Session

**Scenario:** Context window fills (>60%), history truncated.

**Behavior:**
- Working Buffer has been logging since 60% threshold
- Recovery protocol reads buffer first
- Context restored from file

**Recovery:** Compaction Recovery Protocol (see below).

### E6: SESSION-STATE Corruption

**Scenario:** File write interrupted, partial content.

**Mitigation:**
- `sync-session-state.py` writes to temp file first
- Atomic rename: `temp.replace(SESSION_STATE)`
- Prevents partial writes

**Recovery:** Restore from git or manual reconstruction.

### E7: Cron Job Missed

**Scenario:** Evening journal cron fails to fire.

**Evidence:**
- No journal file for date
- Capture file not archived

**Recovery:**
- Manual run: `python3 scripts/evening-journal.py`
- Or: Archive capture manually, create journal manually

### E8: Heartbeat State Desync

**Scenario:** `heartbeat-state.json` corrupted or lost.

**Behavior:**
- `heartbeat-tracker.py` creates fresh state
- Counter resets to 0
- Sync may trigger early or late

**Recovery:** None needed â€” self-healing on next HB.

### E9: Duplicate Journal Generation

**Scenario:** Journal already exists, script runs again.

**Behavior:**
- Script overwrites existing journal
- Capture file already archived (may error on rename)
- Timestamped archive created if collision

**Recovery:** Check for `*.archived.md` files, merge if needed.

### E10: Working Buffer Parse Failure

**Scenario:** Buffer format corrupted, regex fails.

**Behavior:**
- `flush-working-buffer.py` catches exception
- Prints error, returns exit code 1
- Buffer not reset

**Recovery:** Manual inspection and fix of buffer file.

---

## Recovery Procedures

### R1: Compaction Recovery

**Trigger:**
- `<summary>` tag in context
- "context truncated" message
- Human asks "where were we?"
- Missing expected context

**Steps:**

1. **STOP** â€” Do not ask "what were we doing?"

2. **Read `working-buffer.md`**
   ```bash
   cat /root/.openclaw/workspace/working-buffer.md
   ```

3. **Read `SESSION-STATE.md`**
   ```bash
   cat /root/.openclaw/workspace/SESSION-STATE.md
   ```

4. **Read newest capture/journal**
   ```bash
   ls -lt /root/.openclaw/workspace/memory/capture/*.md | head -1
   ls -lt /root/.openclaw/workspace/memory/journal/*.md | head -1
   ```

5. **Present recovery:**
   > "Context was truncated. Last task was [X]. Continue?"

### R2: Manual Evening Journal

**Trigger:** Cron missed, need journal for date.

**Steps:**

1. Check for capture file:
   ```bash
   ls /root/.openclaw/workspace/memory/capture/YYYY-MM-DD.md
   ```

2. Run journal generator:
   ```bash
   python3 /root/.openclaw/workspace/scripts/evening-journal.py
   ```

3. Verify output:
   ```bash
   cat /root/.openclaw/workspace/memory/journal/YYYY-MM-DD.md
   ```

### R3: Manual Working Buffer Flush

**Trigger:** Buffer stale, need to preserve context.

**Steps:**

1. Run flush script:
   ```bash
   python3 /root/.openclaw/workspace/scripts/flush-working-buffer.py
   ```

2. Verify capture updated:
   ```bash
   tail /root/.openclaw/workspace/memory/capture/YYYY-MM-DD.md
   ```

3. Verify buffer reset:
   ```bash
   cat /root/.openclaw/workspace/working-buffer.md
   ```

### R4: Manual SESSION-STATE Sync

**Trigger:** Need immediate sync, don't want to wait for 10 HBs.

**Steps:**

1. Run sync script:
   ```bash
   python3 /root/.openclaw/workspace/scripts/sync-session-state.py
   ```

2. Or dry run first:
   ```bash
   python3 /root/.openclaw/workspace/scripts/sync-session-state.py --dry-run
   ```

### R5: Health Check

**Trigger:** Suspect system issues.

**Steps:**

1. Run health check:
   ```bash
   python3 /root/.openclaw/workspace/scripts/memory-health-check.py
   ```

2. Review report in:
   ```bash
   ls -lt /root/.openclaw/workspace/reports/memory-health-*.json | head -1
   ```

---

## Appendix: File System Layout

```
/root/.openclaw/workspace/
â”‚
â”œâ”€â”€ AGENTS.md                          # Operating rules, WAL Protocol
â”œâ”€â”€ MEMORY-QUICKREF.md                 # Session startup orientation
â”œâ”€â”€ SESSION-STATE.md                   # Persistent context (auto-sync)
â”œâ”€â”€ SOUL.md                            # Agent identity
â”œâ”€â”€ USER.md                            # User profile
â”œâ”€â”€ HEARTBEAT.md                       # Heartbeat checklist
â”œâ”€â”€ TOOLS.md                           # Tool configs, cron rules
â”œâ”€â”€ MEMORY.md                          # Curated long-term memory
â”œâ”€â”€ working-buffer.md                  # Session-local ephemeral context
â”‚
â”œâ”€â”€ memory/
â”‚   â”œâ”€â”€ YYYY-MM-DD.md                  # Daily raw notes (freeform)
â”‚   â”œâ”€â”€ heartbeat-state.json           # HB counter and sync state
â”‚   â”œâ”€â”€ fidget-snapshot.json           # Product tracking data
â”‚   â”œâ”€â”€ fidget-result.txt              # Last fidget check result
â”‚   â”‚
â”‚   â”œâ”€â”€ capture/
â”‚   â”‚   â”œâ”€â”€ YYYY-MM-DD.md              # Active capture file
â”‚   â”‚   â”œâ”€â”€ YYYY-MM-DD.archived.md     # Archived capture
â”‚   â”‚   â””â”€â”€ YYYY-MM-DD.timestamp.archived.md  # Multiple archives
â”‚   â”‚
â”‚   â””â”€â”€ journal/
â”‚       â””â”€â”€ YYYY-MM-DD.md              # Distilled evening journal
â”‚
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ evening-journal.py             # 9 PM distillation
â”‚   â”œâ”€â”€ flush-working-buffer.py        # Buffer flush utility
â”‚   â”œâ”€â”€ heartbeat-tracker.py           # HB counter and sync trigger
â”‚   â”œâ”€â”€ sync-session-state.py          # SESSION-STATE updater
â”‚   â”œâ”€â”€ memory-health-check.py         # System health checker
â”‚   â””â”€â”€ fidget-checker.py              # Product change detector
â”‚
â”œâ”€â”€ notes/                             # PARA structure
â”‚   â”œâ”€â”€ projects/                      # Active projects
â”‚   â”œâ”€â”€ areas/                         # Ongoing responsibilities
â”‚   â”œâ”€â”€ resources/                     # Reference materials
â”‚   â””â”€â”€ archive/                       # Completed/inactive
â”‚
â””â”€â”€ reports/                           # Generated reports
    â””â”€â”€ memory-health-*.json           # Health check outputs
```

---

## Document Metadata

| Property | Value |
|----------|-------|
| **Document Type** | Technical Architecture Diagram |
| **System Version** | proactive-agent v3.1.0 |
| **Generated** | 2026-02-25 |
| **Author** | Kimi Claw (subagent audit) |
| **Review Cycle** | On major system changes |
| **Related Files** | AGENTS.md, MEMORY-QUICKREF.md, SESSION-STATE.md |

---

*End of Technical Architecture Diagram*
